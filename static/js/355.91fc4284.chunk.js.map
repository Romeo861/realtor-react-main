{"version":3,"file":"static/js/355.91fc4284.chunk.js","mappings":"mNAeA,MAwGA,EAxGeA,KACb,MAAOC,EAAUC,IAAeC,EAAAA,EAAAA,UAAS,OAClCC,EAASC,IAAcF,EAAAA,EAAAA,WAAS,IAChCG,EAAoBC,IAAuBJ,EAAAA,EAAAA,UAAS,MA8D3D,OA5DAK,EAAAA,EAAAA,YAAU,MACRC,iBACE,IACE,MAAMC,GAAaC,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAE5BC,GAAIC,EAAAA,EAAAA,IACRJ,GACAK,EAAAA,EAAAA,IAAM,QAAS,MAAM,IACrBC,EAAAA,EAAAA,IAAQ,YAAa,SACrBC,EAAAA,EAAAA,IAAM,IAIFC,QAAkBC,EAAAA,EAAAA,IAAQN,GAC1BO,EAAcF,EAAUG,KAAKH,EAAUG,KAAKC,OAAS,GAC3Df,EAAoBa,GACpB,MAAMnB,EAAW,GACjBiB,EAAUK,SAASC,GACVvB,EAASwB,KAAK,CACnBC,GAAIF,EAAIE,GACRC,KAAMH,EAAIG,WAGdzB,EAAYD,GACZI,GAAW,EACb,CAAE,MAAOuB,GACPC,EAAAA,GAAAA,MAAY,0BACd,CACF,CAEAC,EAAe,GACd,KA8BDC,EAAAA,EAAAA,MAAA,OAAKC,UAAU,QAAOC,SAAA,EACpBC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,eAAcC,SAAC,WAC5B7B,GACC2B,EAAAA,EAAAA,MAAA,OAAKI,MAAO,CAAEC,QAAS,OAAQC,eAAgB,UAAWJ,SAAA,CACvD,KACDC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,0BAEf/B,GAAYA,EAASqB,OAAS,GAChCS,EAAAA,EAAAA,MAAAO,EAAAA,SAAA,CAAAL,SAAA,EACEC,EAAAA,EAAAA,KAAA,QAAAD,UACEC,EAAAA,EAAAA,KAAA,MAAIF,UAAU,iBAAgBC,SAC3BhC,EAASsC,KAAKC,IACbN,EAAAA,EAAAA,KAACO,EAAAA,EAAW,CAEVf,GAAIc,EAAQd,GACZc,QAASA,EAAQb,MAFZa,EAAQd,UAOpBpB,IACC4B,EAAAA,EAAAA,KAAA,OAAKF,UAAU,4BAA2BC,UACxCC,EAAAA,EAAAA,KAAA,UACEQ,QAnDdjC,iBACE,IACE,MAAMC,GAAaC,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAC5BC,GAAIC,EAAAA,EAAAA,IACRJ,GACAK,EAAAA,EAAAA,IAAM,QAAS,MAAM,IACrBC,EAAAA,EAAAA,IAAQ,YAAa,SACrB2B,EAAAA,EAAAA,IAAWrC,IACXW,EAAAA,EAAAA,IAAM,IAEFC,QAAkBC,EAAAA,EAAAA,IAAQN,GAC1BO,EAAcF,EAAUG,KAAKH,EAAUG,KAAKC,OAAS,GAC3Df,EAAoBa,GACpB,MAAMnB,EAAW,GACjBiB,EAAUK,SAASC,GACVvB,EAASwB,KAAK,CACnBC,GAAIF,EAAIE,GACRC,KAAMH,EAAIG,WAGdzB,GAAa0C,GAAc,IAAIA,KAAc3C,KAC7CI,GAAW,EACb,CAAE,MAAOuB,GACPC,EAAAA,GAAAA,MAAY,0BACd,CACF,EA2BcG,UAAU,uBAAsBC,SACjC,oBAOPC,EAAAA,EAAAA,KAAA,KAAAD,SAAG,kCAED,C","sources":["pages/Offers.jsx"],"sourcesContent":["import {\n  collection,\n  getDocs,\n  limit,\n  orderBy,\n  query,\n  startAfter,\n  where,\n} from \"firebase/firestore\";\nimport React, { useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\nimport { db } from \"../firebase\";\nimport \"./Offers.scss\";\nimport ListingItem from \"../components/ListingItem\";\n\nconst Offers = () => {\n  const [listings, setListings] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [lastFetchedListing, setLastFetchListing] = useState(null);\n\n  useEffect(() => {\n    async function fetchListings() {\n      try {\n        const listingRef = collection(db, \"listings\");\n        // Create query\n        const q = query(\n          listingRef,\n          where(\"offer\", \"==\", true),\n          orderBy(\"timestamp\", \"desc\"),\n          limit(8)\n        );\n\n        // Execute query\n        const querySnap = await getDocs(q);\n        const lastVisible = querySnap.docs[querySnap.docs.length - 1];\n        setLastFetchListing(lastVisible);\n        const listings = [];\n        querySnap.forEach((doc) => {\n          return listings.push({\n            id: doc.id,\n            data: doc.data(),\n          });\n        });\n        setListings(listings);\n        setLoading(false);\n      } catch (error) {\n        toast.error(\"Could not fetch listing\");\n      }\n    }\n\n    fetchListings();\n  }, []);\n\n  async function onFetchMoreListings() {\n    try {\n      const listingRef = collection(db, \"listings\");\n      const q = query(\n        listingRef,\n        where(\"offer\", \"==\", true),\n        orderBy(\"timestamp\", \"desc\"),\n        startAfter(lastFetchedListing),\n        limit(4)\n      );\n      const querySnap = await getDocs(q);\n      const lastVisible = querySnap.docs[querySnap.docs.length - 1];\n      setLastFetchListing(lastVisible);\n      const listings = [];\n      querySnap.forEach((doc) => {\n        return listings.push({\n          id: doc.id,\n          data: doc.data(),\n        });\n      });\n      setListings((prevState) => [...prevState, ...listings]);\n      setLoading(false);\n    } catch (error) {\n      toast.error(\"Could not fetch listing\");\n    }\n  }\n\n  return (\n    <div className=\"offer\">\n      <h1 className=\"offer__title\">Offers</h1>\n      {loading ? (\n        <div style={{ display: \"flex\", justifyContent: \"center\" }}>\n          {\" \"}\n          <div className=\"loader loader--big\"></div>\n        </div>\n      ) : listings && listings.length > 0 ? (\n        <>\n          <main>\n            <ul className=\"offer__listing\">\n              {listings.map((listing) => (\n                <ListingItem\n                  key={listing.id}\n                  id={listing.id}\n                  listing={listing.data}\n                />\n              ))}\n            </ul>\n          </main>\n          {lastFetchedListing && (\n            <div className=\"offer__load-more-btn-wrap\">\n              <button\n                onClick={onFetchMoreListings}\n                className=\"offer__load-more-btn\"\n              >\n                Load more\n              </button>\n            </div>\n          )}\n        </>\n      ) : (\n        <p>There are no current offers</p>\n      )}\n    </div>\n  );\n};\n\nexport default Offers;\n"],"names":["Offers","listings","setListings","useState","loading","setLoading","lastFetchedListing","setLastFetchListing","useEffect","async","listingRef","collection","db","q","query","where","orderBy","limit","querySnap","getDocs","lastVisible","docs","length","forEach","doc","push","id","data","error","toast","fetchListings","_jsxs","className","children","_jsx","style","display","justifyContent","_Fragment","map","listing","ListingItem","onClick","startAfter","prevState"],"sourceRoot":""}